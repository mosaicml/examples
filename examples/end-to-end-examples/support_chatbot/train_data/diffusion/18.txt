Title: index.json file missing
Date: 05/2023

Question:

Hi,
I have followed the data preparation steps as described in the laion2b-en-interactive.yaml and precompute-latents.yaml files. When computing the gradients, I get an error regarding a missing index.json file in the aesthetic output folder.My aesthetic output folder contains the sharded parquet files and corresponding stats,json files. What is the purpose of the index.json file and how can I generate it?FYI, I am only using a small subset of the dataset ~10% for this experiment. Thanks.

Traceback (most recent call last):
  File "/home/ubuntu/diffusion/precompute_latents.py", line 357, in <module>
    main(parse_args())
  File "/home/ubuntu/diffusion/precompute_latents.py", line 229, in main
    dataloader = build_streaming_laion_dataloader(
  File "/home/ubuntu/diffusion/precompute_latents.py", line 166, in build_streaming_laion_dataloader
    dataset = StreamingLAIONDataset(
  File "/home/ubuntu/diffusion/precompute_latents.py", line 58, in __init__
    super().__init__(
  File "/home/ubuntu/anaconda3/envs/mosaic/lib/python3.9/site-packages/streaming/base/dataset.py", line 264, in __init__
    stream_shards = stream.get_shards(world)
  File "/home/ubuntu/anaconda3/envs/mosaic/lib/python3.9/site-packages/streaming/base/stream.py", line 303, in get_shards
    filename = self._download_file(basename)
  File "/home/ubuntu/anaconda3/envs/mosaic/lib/python3.9/site-packages/streaming/base/stream.py", line 199, in _download_file
    download_file(remote, local, self.download_timeout)
  File "/home/ubuntu/anaconda3/envs/mosaic/lib/python3.9/site-packages/streaming/base/storage/download.py", line 234, in download_file
    download_from_local(remote, local)
  File "/home/ubuntu/anaconda3/envs/mosaic/lib/python3.9/site-packages/streaming/base/storage/download.py", line 204, in download_from_local
    shutil.copy(remote, local_tmp)
  File "/home/ubuntu/anaconda3/envs/mosaic/lib/python3.9/shutil.py", line 427, in copy
    copyfile(src, dst, follow_symlinks=follow_symlinks)
  File "/home/ubuntu/anaconda3/envs/mosaic/lib/python3.9/shutil.py", line 264, in copyfile
    with open(src, 'rb') as fsrc:
FileNotFoundError: [Errno 2] No such file or directory: '/home/ubuntu/mosaic/aesthetic/1/index.json'

Answer:

In our data preparation, we convert it to a streaming dataset, which has an index file so it knows how to prepare and shuffle data.

You can see this in the last step of laion2b-en-interactive.yaml here. Concretely, after you download the data, you can run (step 4)

python3 laion_cloudwriter.py --local /tmp/laion2b-processed --remote {YOUR BUCKET HERE} --bucketed --subfolder 1 --wandb_disabled
which will convert the downloaded data into streaming dataset.

Please feel free to ask any follow-up questions!