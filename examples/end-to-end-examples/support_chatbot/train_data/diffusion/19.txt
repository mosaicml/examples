Title: Question regarding the training dataset
Date: 05/2023

Question:

Hope this finds you well. Very amazing work!!!
As mentioned in https://github.com/mosaicml/diffusion#how-many-gpus-do-i-need, "Our time estimates are based on training Stable Diffusion 2.0 base on 1,126,400,000 images at 256x256 resolution and 1,740,800,000 images at 512x512 resolution".
I have three questions:

since the whole data of ChristophSchuhmann/improved_aesthetics_4.5plus is 1.2B, how come that you have 1.74B images with original resolution > 512x512?
I am also downloading ChristophSchuhmann/improved_aesthetics_4.5plus, but it turns out that the failed ratio is about 20%, which means I can only get about 960M images. How could you download 1.12B images at 256x256 resolution? I follow the downloading script provided in this repo.
According to stabilityai/stable-diffusion-2-base, they said "The model is trained from scratch 550k steps at resolution 256x256 on a subset of LAION-5B filtered for explicit pornographic material, using the LAION-NSFW classifier with punsafe=0.1 and an aesthetic score >= 4.5. Then it is further trained for 850k steps at resolution 512x512 on the same dataset on images with resolution >= 512x512". Have you applied punsafe=0.1 in your training? I suppose "punsafe=0.1" means that we only use samples with punsafe<0.1, am I correct?
Thanks very much!!!

Answer:

    since the whole data of ChristophSchuhmann/improved_aesthetics_4.5plus is 1.2B, how come that you have 1.74B images with original resolution > 512x512?
We use multiple epochs, so some data is repeated

    I am also downloading ChristophSchuhmann/improved_aesthetics_4.5plus, but it turns out that the failed ratio is about 20%, which means I can only get about 960M images. How could you download 1.12B images at 256x256 resolution? I follow the downloading script provided in this repo.
We see a failure rate around that. Depending on your internet settings, IP address, VPN, etc, you may get higher or lower failure rates. This is because some links from LAION are either now broken or are blocking you. I think this is probably fine. We also repeat data at 256x256 resolution

    According to stabilityai/stable-diffusion-2-base, they said "The model is trained from scratch 550k steps at resolution 256x256 on a subset of LAION-5B filtered for explicit pornographic material, using the LAION-NSFW classifier with punsafe=0.1 and an aesthetic score >= 4.5. Then it is further trained for 850k steps at resolution 512x512 on the same dataset on images with resolution >= 512x512". Have you applied punsafe=0.1 in your training? I suppose "punsafe=0.1" means that we only use samples with punsafe<0.1, am I correct?
I do not think we did this data filtering step. If you would like to do so, you can do it in the upload script (mds writer) by adding an if statement conditioned on that field

Question:

Thanks. May I know how many images have you downloaded? Since I want to use your code to reproduce the result you reported, trying to make sure my data is not the potential issue.

Answer:

For images with resolution >= 256x256, we have ~790 million image-caption pairs. For images with resolution >= 512x512, we had ~300 million image-caption pairs.

We did not do any punsafe or pwatermark filtering. I agree with you that punsafe=0.1 likely means punsafe<0.1, but definitely check with stability folks.

Question:

Thanks. I mean the total number of images, including all resolutions. Do you have this number?

BTW, you only use the images with original resolution >= 256*256 in the stage 1 training? I thought we should use all images in stage 1, just resize them to 256*256 according to stabilityai/stable-diffusion-2-base

Answer:

We had ~1.2 billion image-text pairs total.

We suspected some correlation between aesthetic score and image resolution and that resizing the low resolution images could generate a lot of artifacts, so we only trained on >= 256x256.

Question:

One more question: when we are talking about the original image size (H, W) >= 256*256, does it mean H>=256 and W>256 or just H*W >= 256*256? Thanks in advance!

Answer:

The former, both H and W are >= 256
