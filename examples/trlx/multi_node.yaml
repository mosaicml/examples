run_name: trlx-multi-node
image: mosaicml/pytorch:1.13.1_cu117-python3.10-ubuntu20.04
gpu_num: 16
cluster: # FILL IN

integrations:
- integration_type: git_repo
  git_repo: dakinggg/trlx
  git_commit: barrier # temporary until https://github.com/CarperAI/trlx/pull/406 or similar is merged
  pip_install: .
  path: /workspace/trlx

command: |
  cd /workspace/trlx/examples
  accelerate launch \
    --num_processes 16 \
    --num_machines 2 \
    --use_deepspeed \
    --deepspeed_multinode_launcher standard \
    --machine_rank $NODE_RANK \
    --main_process_ip $MASTER_ADDR \
    --main_process_port $MASTER_PORT \
    simulacra.py
